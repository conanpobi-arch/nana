<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>나나 연구실 V3.0 - OROW</title>
    <style>
        :root { --neon: #00ffcc; --bg: #0a0a0b; }
        body { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: 'Apple SD Gothic Neo', sans-serif; overflow: hidden; }
        .screen { width: 100vw; height: 100vh; background: radial-gradient(circle at center, #1a1a1f 0%, #000 100%); display: flex; align-items: center; justify-content: center; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border-radius: 40px; padding: 30px; border: 1px solid rgba(0, 255, 204, 0.2); width: 85%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .status-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; margin-bottom: 15px; border: 1px solid var(--neon); color: var(--neon); text-transform: uppercase; }
        textarea { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 15px; color: #fff; padding: 15px; box-sizing: border-box; font-size: 14px; height: 150px; outline: none; transition: 0.3s; }
        textarea:focus { border-color: var(--neon); box-shadow: 0 0 15px rgba(0, 255, 204, 0.2); }
        #result-area { display: none; background: rgba(0, 255, 204, 0.05); border-radius: 15px; padding: 15px; border: 1px solid rgba(0, 255, 204, 0.3); margin-top: 15px; text-align: left; font-size: 15px; line-height: 1.8; color: #e0e0e0; max-height: 200px; overflow-y: auto; white-space: pre-wrap; }
        .btn-run { background: var(--neon); color: #000; border: none; border-radius: 15px; padding: 18px; font-weight: bold; cursor: pointer; font-size: 16px; width: 100%; margin-top: 15px; transition: 0.3s; }
        .btn-run:active { transform: scale(0.98); opacity: 0.8; }
        .log-text { font-size: 11px; color: #666; margin-top: 10px; min-height: 15px; }
    </style>
</head>
<body>

<div class="screen">
    <div class="glass-panel">
        <div class="status-badge" id="engine-status">Engine Standby</div>
        <h1 style="margin: 0 0 20px 0; font-size: 24px; letter-spacing: -1px;">나나 연구실 <span style="color:var(--neon)">V3.0</span></h1>
        
        <textarea id="text-input" placeholder="번역할 소설 원문을 입력하세요..."></textarea>
        
        <div id="result-area"></div>
        
        <button class="btn-run" id="main-btn" onclick="startProcess()">엔진 기동</button>
        <div class="log-text" id="status-log">시스템 최적화 완료. 준비되었습니다.</div>
    </div>
</div>

<script>
    const API_KEY = "AIzaSyDFlvK6qzBAxM9D35-ehMu_duAYWjBXSVY";
    let MASTER_URL = "";

    const log = (msg) => document.getElementById('status-log').innerText = msg;
    const resultArea = document.getElementById('result-area');

    // [핵심] 최적의 경로를 찾아 MASTER_URL에 고정하는 자동 스캐너
    async function findPath() {
        const models = ['gemini-2.0-flash-exp', 'gemini-1.5-flash', 'gemini-1.5-flash-002'];
        const vers = ['v1beta', 'v1'];

        for (let v of vers) {
            for (let m of models) {
                const url = `https://generativelanguage.googleapis.com/${v}/models/${m}:generateContent?key=${API_KEY}`;
                try {
                    const resp = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: "hi" }] }] })
                    });
                    if (resp.ok) return url;
                } catch (e) {}
            }
        }
        return null;
    }

    async function startProcess() {
        const input = document.getElementById('text-input').value;
        const btn = document.getElementById('main-btn');
        if (!input) return alert("본문을 입력하세요!");

        btn.disabled = true;
        log("적합한 엔진 경로 탐색 중...");
        
        if (!MASTER_URL) {
            MASTER_URL = await findPath();
        }

        if (!MASTER_URL) {
            log("❌ 모든 엔진 경로 차단됨. 키 설정을 확인하세요.");
            btn.disabled = false;
            return;
        }

        log("✅ 엔진 연결 성공! 번역 시작...");
        document.getElementById('engine-status').innerText = "Translating...";
        resultArea.style.display = 'block';
        resultArea.innerText = "데이터 분석 중...";

        try {
            const response = await fetch(MASTER_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `당신은 무협 소설 전문 번역가입니다. 다음 지침을 엄수하십시오.
                            1. No Omission: 문장을 하나도 빠짐없이 번역하라.
                            2. 대한민국 한자음: 인명, 지명, 무공은 한국 한자음으로 표기하라. (중국식 발음 금지)
                            3. 구어체: 무협 소설 특유의 장중하고 자연스러운 한국어 문체를 사용하라.
                            
                            본문:
                            ${input}`
                        }]
                    }]
                })
            });

            const data = await response.json();
            if (data.candidates && data.candidates[0].content) {
                resultArea.innerText = data.candidates[0].content.parts[0].text;
                log("번역 완료.");
                document.getElementById('engine-status').innerText = "Engine Stable";
            } else {
                throw new Error(data.error?.message || "Unknown Error");
            }
        } catch (e) {
            resultArea.innerText = "오류 발생: " + e.message;
            log("엔진 오류 보고됨.");
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
