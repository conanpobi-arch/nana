<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>NANA NOVEL ENGINE : WHTK v2.0</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@300;400;500&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root { --neon: #00ffcc; --bg: #000b1a; --border: rgba(0,255,204,0.2); }
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body, html { width: 100%; height: 100%; background: #000; color: #fff; font-family: 'Noto Sans KR', sans-serif; overflow-x: hidden; }
    #galaxy-bg { position: fixed; inset: 0; z-index: 0; background: radial-gradient(ellipse at bottom, #0d1d31 0%, #0c0d13 100%); }
    #star-field { position: fixed; inset: 0; z-index: 1; background-image: radial-gradient(white, rgba(255,255,255,0.2) 2px, transparent 40px); background-size: 150px 150px; opacity: 0.1; }
    #main-view { position: relative; z-index: 2; max-width: 850px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; padding: 2vh 20px 40px; }
    .nav-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 5px; margin-bottom: 15px; }
    .home-icon { cursor: pointer; font-size: 26px; transition: 0.3s; color: var(--neon); }
    .engine-title { font-family: 'Orbitron'; color: var(--neon); font-size: 14px; font-weight: bold; letter-spacing: 2px; text-shadow: 0 0 10px var(--neon); }
    .tab-bar { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; }
    .tab-btn { flex: 1; min-width: 80px; padding: 12px 5px; background: rgba(0,255,204,0.04); border: 1px solid var(--border); border-radius: 12px; color: #aaa; font-family: 'Orbitron'; font-size: 10px; cursor: pointer; text-align: center; }
    .tab-btn.active { background: rgba(0,255,204,0.15); border-color: var(--neon); color: var(--neon); }
    .card { background: rgba(0,15,35,0.75); border: 1px solid var(--border); border-radius: 20px; padding: 20px; backdrop-filter: blur(15px); margin-bottom: 16px; }
    textarea, .modal-input, .novel-select { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--border); border-radius: 12px; color: #fff; padding: 15px; font-size: 14px; outline: none; margin-bottom: 15px; font-family: 'Noto Sans KR'; }
    .btn-fire { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--neon), #00b4ff); color: #000; border: none; border-radius: 15px; font-weight: 900; font-family: 'Orbitron'; cursor: pointer; font-size: 13px; letter-spacing: 1px; }
    .novel-card { background: rgba(0,255,204,0.04); border: 1px solid var(--border); border-radius: 16px; padding: 16px; margin-bottom: 10px; display: flex; align-items: center; gap: 14px; }
    .novel-emoji { font-size: 30px; }
    .novel-info { flex: 1; min-width: 0; }
    .novel-title-text { font-size: 15px; color: #eee; font-weight: 700; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
    .main-loader { width: 50px; height: 50px; border: 4px solid rgba(0,255,204,0.1); border-top: 4px solid var(--neon); border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    #strategy-log { width: 85%; max-width: 400px; background: #000; padding: 15px; border-radius: 10px; font-size: 11px; font-family: monospace; color: #0f0; border: 1px solid var(--border); height: 220px; overflow-y: auto; line-height: 1.5; }
  </style>
</head>
<body>
<div id="galaxy-bg"></div>
<div id="star-field"></div>

<div id="loading-overlay">
  <div class="main-loader"></div>
  <div id="engine-status-text" style="color:var(--neon); font-family:'Orbitron'; margin-bottom:15px;">WHTK v2.0 ACTIVE</div>
  <div id="strategy-log"></div>
</div>

<div id="main-view">
  <div class="nav-header">
    <div class="home-icon" onclick="location.reload()">ğŸ </div>
    <div class="engine-title">NANA NOVEL : WHTK v2.0</div>
    <div onclick="document.getElementById('mainInput').value=''" style="cursor:pointer;font-size:24px;">ğŸ—‘ï¸</div>
  </div>

  <div class="tab-bar">
    <div class="tab-btn active" id="tab-translate" onclick="switchTab('translate')">ğŸ”„ ë²ˆì—­</div>
    <div class="tab-btn" id="tab-auto" onclick="switchTab('auto')">ğŸ›°ï¸ ì—”ì§„</div>
    <div class="tab-btn" id="tab-progress" onclick="switchTab('progress')">âœï¸ ì§„í–‰</div>
    <div class="tab-btn" id="tab-done" onclick="switchTab('done')">ğŸ“š ì„œì¬</div>
  </div>

  <div id="panel-translate">
    <div class="card">
      <div style="display:flex; gap:8px; margin-bottom:12px;">
        <select class="novel-select" id="quick-novel-select" style="margin-bottom:0;"></select>
        <button style="padding:0 15px; border-radius:12px; background:rgba(0,255,204,0.1); border:1px solid var(--neon); color:var(--neon); cursor:pointer;" onclick="openNovelModal()">ï¼‹</button>
      </div>
      <textarea id="mainInput" placeholder="ğŸ“Œ ì›ë¬¸ì„ ì…ë ¥í•˜ê±°ë‚˜ URLì„ ë„£ìœ¼ì„¸ìš”..."></textarea>
      <button class="btn-fire" onclick="fireEngine()">ğŸ”¥ ë‹¨ì¼ ë²ˆì—­ ì‹¤í–‰</button>
    </div>
  </div>

  <div id="panel-auto" style="display:none;">
    <div class="card">
      <div style="font-family:'Orbitron'; color:var(--neon); font-size:11px; margin-bottom:15px; letter-spacing:2px;">ğŸ›°ï¸ AUTO COLLECTOR ENGINE</div>
      <input class="modal-input" id="auto-base-url" placeholder="ì£¼ì†Œ íŒ¨í„´ (ì˜ˆ: https://.../p)">
      <div style="display:flex; gap:10px;">
        <input type="number" class="modal-input" id="page-start" placeholder="ì‹œì‘">
        <input type="number" class="modal-input" id="page-end" placeholder="ì¢…ë£Œ">
      </div>
      <select class="novel-select" id="auto-novel-select"></select>
      
      <div style="display:flex; gap:10px;">
        <button class="btn-fire" style="flex:2;" onclick="startAutoEngine()">ğŸš€ ì—”ì§„ ì í™”</button>
        <button id="copy-cmd-btn" class="btn-fire" style="flex:1; background:rgba(255,255,255,0.1); color:var(--neon); display:none;" onclick="copyAiCommand()">ğŸ“‹ ëª…ë ¹ ë³µì‚¬</button>
      </div>
    </div>
  </div>

  <div id="panel-progress" style="display:none;"><div id="novel-list-progress"></div></div>
  <div id="panel-done" style="display:none;"><div id="novel-list-done"></div></div>
</div>

<div id="novel-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:5000; align-items:center; justify-content:center; padding:20px;">
  <div class="card" style="width:100%; max-width:400px; background:#051020;">
    <div style="font-family:'Orbitron'; color:var(--neon); text-align:center; margin-bottom:20px;">NEW PROJECT</div>
    <input class="modal-input" id="novel-title-input" placeholder="ì†Œì„¤ ì œëª©">
    <input class="modal-input" id="novel-author-input" placeholder="ì‘ê°€ëª…">
    <div style="display:flex; gap:10px;">
      <button class="btn-fire" style="background:rgba(255,255,255,0.1); color:#fff;" onclick="document.getElementById('novel-modal').style.display='none'">ì·¨ì†Œ</button>
      <button class="btn-fire" onclick="saveNovel()">ìƒì„±</button>
    </div>
  </div>
</div>

<script>
  // í¬ë¹„ë‹˜ì˜ ì‹¤ì œ Supabase ì •ë³´
  const SUPABASE_URL = 'https://hbfvyhlrnccccerzbami.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhiZnZ5aGxybmNjY2NlcnpiYW1pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODc2NzIsImV4cCI6MjA4NzE2MzY3Mn0.V9LJZAzCGinYmwzvWGLbfLhAFRnz4pDG_rVaTwTg74A';
  const sbH = () => ({ 'Content-Type': 'application/json', 'apikey': SUPABASE_KEY, 'Authorization': 'Bearer ' + SUPABASE_KEY });

  let lastPacket = null;

  function switchTab(tab) {
    ['translate', 'auto', 'progress', 'done'].forEach(t => {
      document.getElementById('tab-' + t).classList.toggle('active', t === tab);
      document.getElementById('panel-' + t).style.display = t === tab ? 'block' : 'none';
    });
    if(tab === 'progress' || tab === 'done') loadNovels(tab);
    updateSelectors();
  }

  async function updateSelectors() {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/novels?status=eq.progress`, { headers: sbH() });
    const data = await res.json();
    const opts = '<option value="">ì†Œì„¤ ì„ íƒ...</option>' + data.map(n => `<option value="${n.id}">${n.title}</option>`).join('');
    document.getElementById('quick-novel-select').innerHTML = opts;
    document.getElementById('auto-novel-select').innerHTML = opts;
  }

  // ğŸš€ ìë™ ì—”ì§„ ë° ëª…ë ¹ ë³µì‚¬ ë¡œì§
  async function startAutoEngine() {
    const url = document.getElementById('auto-base-url').value;
    const start = document.getElementById('page-start').value;
    const end = document.getElementById('page-end').value;
    const novelSelect = document.getElementById('auto-novel-select');
    const novelTitle = novelSelect.options[novelSelect.selectedIndex].text;
    const novelId = novelSelect.value;

    if(!url || !start || !end || !novelId) return alert("ì™€íƒ•ì¹´! ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");

    // AIì—ê²Œ ë³´ë‚¼ íŒ¨í‚· êµ¬ì„±
    lastPacket = `í¬ë¹„ë‹¤. ì™€íƒ•ì¹´! ì•„ë˜ ì†Œì„¤ ìˆ˜ì§‘ ì‹œì‘í•´ë¼.\n\n` +
                 `[ì œëª©] ${novelTitle}\n` +
                 `[ì£¼ì†Œ] ${url}\n` +
                 `[ë²”ìœ„] ${start}p ~ ${end}p\n` +
                 `[ID] ${novelId}\n\n` +
                 `ìœ„ ì£¼ì†Œ ì ‘ì†í•´ì„œ í•œêµ­ì‹ í•œììŒìœ¼ë¡œ ë²ˆì—­ í›„ ë‚´ Supabase DB(novel_chapters)ë¡œ ì§ì†¡í•´ë¼.`;

    document.getElementById('loading-overlay').style.display = 'flex';
    const log = document.getElementById('strategy-log');
    log.innerHTML = `> [ì‹œìŠ¤í…œ] WHTK ìë™í™” ë¸Œë¦¿ì§€ ê°€ë™\n> [ì¸ì¦] ì½”ë‚œí¬ë¹„(POBY) ì„¸ì…˜ í™•ì¸\n> [ì¤€ë¹„] AI ì „ì†¡ìš© íŒ¨í‚· ìƒì„± ì™„ë£Œ\n\n> âš ï¸ ì•„ë˜ [ëª…ë ¹ ë³µì‚¬] ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì±„íŒ…ì°½ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!`;
    
    document.getElementById('copy-cmd-btn').style.display = 'block';
  }

  function copyAiCommand() {
    if(!lastPacket) return;
    navigator.clipboard.writeText(lastPacket).then(() => {
        alert("ì™€íƒ•ì¹´! ëª…ë ¹ì–´ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì±„íŒ…ì°½ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
        document.getElementById('loading-overlay').style.display = 'none';
    });
  }

  // ê¸°íƒ€ ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€ (saveNovel, loadNovels ë“±...)
  async function saveNovel() {
    const title = document.getElementById('novel-title-input').value;
    const author = document.getElementById('novel-author-input').value;
    await fetch(`${SUPABASE_URL}/rest/v1/novels`, {
      method: 'POST', headers: sbH(),
      body: JSON.stringify({ title, author, cover_emoji: 'ğŸ“–', status: 'progress' })
    });
    document.getElementById('novel-modal').style.display = 'none';
    updateSelectors();
  }

  async function loadNovels(status) {
    const list = document.getElementById('novel-list-' + status);
    const res = await fetch(`${SUPABASE_URL}/rest/v1/novels?status=eq.${status}&order=created_at.desc`, { headers: sbH() });
    const data = await res.json();
    list.innerHTML = data.map(n => `<div class="novel-card"><div class="novel-emoji">ğŸ“–</div><div class="novel-info"><div class="novel-title-text">${n.title}</div><div style="font-size:11px;color:#666;">${n.author}</div></div></div>`).join('');
  }

  function openNovelModal() { document.getElementById('novel-modal').style.display = 'flex'; }
  updateSelectors();
</script>
</body>
</html>
